# GitHub Action: Auto-sync to Bitbucket
# 
# SETUP: Add secret BITBUCKET_TOKEN with your Repository Access Token
#
# WORKFLOW:
# 1. Emergent pushes to GitHub (any branch, e.g., 'emergent-dev')
# 2. This action syncs THAT SAME branch to Bitbucket
# 3. You manually merge to 'main' on Bitbucket when ready

name: Sync to Bitbucket

on:
  push:
    branches:
      - main
      - master
      - emergent-dev      # Branch for Emergent changes
      - 'feature/**'      # Any feature branches
      - 'dev/**'          # Any dev branches
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Push to Bitbucket
        env:
          BITBUCKET_TOKEN: ${{ secrets.BITBUCKET_TOKEN }}
        run: |
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"
          
          # Add Bitbucket remote
          git remote add bitbucket "https://x-token-auth:${BITBUCKET_TOKEN}@bitbucket.org/smartmaheshwari-official/smartchesscoach.git"
          
          # Get current branch name
          BRANCH_NAME="${GITHUB_REF#refs/heads/}"
          echo "ðŸ“Œ Syncing branch: $BRANCH_NAME"
          
          # Push only the current branch to Bitbucket (same branch name)
          git push bitbucket HEAD:$BRANCH_NAME --force
          
          echo "âœ… Synced branch '$BRANCH_NAME' to Bitbucket!"
